# dtsgrep - è®¾å¤‡æ ‘é€’å½’æœç´¢å·¥å…·

!https://img.shields.io/badge/Python-3.6%2B-blue
!https://img.shields.io/badge/License-MIT-green
!https://img.shields.io/badge/Platform-Linux%20%7C%20macOS%20%7C%20WSL-lightgrey

`dtsgrep` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“ä¸ºè®¾å¤‡æ ‘å¼€å‘è€…è®¾è®¡ï¼Œç”¨äºåœ¨å¤æ‚è®¾å¤‡æ ‘ç»“æ„ä¸­é€’å½’æœç´¢æŒ‡å®šå­—æ®µã€‚å®ƒå¯ä»¥è§£æ `.dts` å’Œ `.dtsi` æ–‡ä»¶ä¸­çš„åŒ…å«å…³ç³»ï¼Œå¹¶åœ¨æ‰€æœ‰ç›¸å…³æ–‡ä»¶ä¸­ç²¾ç¡®æŸ¥æ‰¾åŒ¹é…å†…å®¹ï¼Œæä¾›è¯¦ç»†çš„å®šä½ä¿¡æ¯ã€‚

## åŠŸèƒ½äº®ç‚¹

ğŸ” **æ™ºèƒ½é€’å½’æœç´¢** - è‡ªåŠ¨è§£æè®¾å¤‡æ ‘æ–‡ä»¶ä¸­çš„å¼•ç”¨å…³ç³»ï¼Œæ”¯æŒåµŒå¥— `#include` å’Œ `/include/` è¯­æ³•  
ğŸ“‚ **è·¯å¾„æ™ºèƒ½å¤„ç†** - è‡ªåŠ¨å¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œæ”¯æŒè·¨ç›®å½•å¼•ç”¨  
âš¡ **æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ** - æ”¯æŒå®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…  
ğŸ› ï¸ **å¢å¼ºæœç´¢é€‰é¡¹**ï¼š
- `-i`/`--ignore-case` - å¿½ç•¥å¤§å°å†™
- `-w`/`--word-regexp` - æ•´è¯åŒ¹é…
- `-v`/`--invert-match` - åå‘åŒ¹é…ï¼ˆæ˜¾ç¤ºä¸åŒ¹é…çš„è¡Œï¼‰

## ä½¿ç”¨åœºæ™¯

- å¿«é€Ÿå®šä½è®¾å¤‡æ ‘ä¸­çš„ç‰¹å®šé…ç½®é¡¹
- è°ƒè¯•å¤æ‚çš„è®¾å¤‡æ ‘åŒ…å«ç»“æ„
- éªŒè¯è®¾å¤‡æ ‘ä¿®æ”¹çš„å½±å“èŒƒå›´
- å­¦ä¹ å¤§å‹è®¾å¤‡æ ‘é¡¹ç›®ç»“æ„

## å®‰è£…æ–¹æ³•

1. ä¸‹è½½dtsgrepåˆ°~/.local/bin
2. ç»™äºˆæ‰§è¡Œæƒé™
```bash
chmod +x ~/.local/bin/dtsgrep
```

3. ç¡®ä¿ `~/.local/bin` åœ¨æ‚¨çš„ PATH ç¯å¢ƒå˜é‡ä¸­ï¼š
```bash
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æœç´¢
```bash
dtsgrep myboard.dts 'gpio-controller'
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
åœ¨3å¤„æ‰¾åˆ°'gpio-controller':

[1] ./common.dtsi:45
    gpio: gpio-controller@0 {

[2] ./soc.dtsi:128
    gpio2: gpio-controller@d401 {

[3] ./myboard.dts:201
    my-device {
        compatible = "gpio-controller";
    }
```

### é«˜çº§æœç´¢é€‰é¡¹
```bash
# æ•´è¯åŒ¹é… + å¿½ç•¥å¤§å°å†™
dtsgrep -iw main.dts 'SPI'

# åå‘åŒ¹é…ï¼ˆæ˜¾ç¤ºä¸åŒ…å«'status = "disabled"'çš„è¡Œï¼‰
dtsgrep -v board.dts 'status = "disabled"'

# å¤šæ¨¡å¼æœç´¢
dtsgrep top.dts 'clock-frequency' 'pinctrl_[a-z0-9_]+'
```

### ä½¿ç”¨ç»å¯¹è·¯å¾„
```bash
dtsgrep /path/to/project/device-trees/main.dts 'interrupt-controller'
```

## æŠ€æœ¯åŸç†

`dtsgrep` ä½¿ç”¨ä¸¤æ­¥å¤„ç†æµç¨‹ï¼š
1. **é€’å½’ä¾èµ–è§£æ** - æ·±åº¦ä¼˜å…ˆæœç´¢è§£æè®¾å¤‡æ ‘æ–‡ä»¶çš„åŒ…å«å…³ç³»ï¼š
   - æ”¯æŒ `#include "file.dtsi"` å’Œ `/include/ "file.dtsi"` è¯­æ³•
   - æ™ºèƒ½è·¯å¾„è§£æï¼ˆä¼˜å…ˆç›¸å¯¹å½“å‰æ–‡ä»¶ç›®å½•ï¼‰
   - é¿å…é‡å¤å¤„ç†å’Œå¾ªç¯å¼•ç”¨

2. **æ­£åˆ™æ¨¡å¼åŒ¹é…**ï¼š
   - æ•´è¯åŒ¹é…ä½¿ç”¨ `\b` è¾¹ç•Œç¬¦å®ç°ç²¾ç¡®æœç´¢
   - å¤šæ¨¡å¼å¹¶è¡Œå¤„ç†æé«˜æœç´¢æ•ˆç‡
   - ç»Ÿä¸€å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„æ¢è¡Œç¬¦ï¼ˆLF/CRLF/CRï¼‰

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ LICENSEï¼Œå…è®¸è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ã€‚